import"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js";document.addEventListener("DOMContentLoaded",()=>{const r=JSON.parse(document.getElementById("places-data").textContent),a=JSON.parse(document.getElementById("target-url").textContent),l=JSON.parse(document.getElementById("zoom-level").textContent),n=r.find(t=>t.url==a),p=n?[n.lat,n.lng]:[35.97607932324101,140.1408927819724],e=L.map("map").setView(p,l);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(e);const d=L.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),g=L.icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});r.forEach(t=>{const i=t.url===a,s=L.marker([t.lat,t.lng],{icon:i?g:d}).addTo(e);if(i){const m=L.Control.extend({options:{position:"topright"},onAdd:function(){const o=L.DomUtil.create("div","leaflet-bar leaflet-control");return o.style.backgroundColor="white",o.style.padding="5px",o.style.cursor="pointer",o.title="Google Mapで開く",o.innerHTML="🔗Google Mapで開く",o.onclick=function(){const c=e.getCenter(),u=c.lat,h=c.lng,w=`https://www.google.com/maps/search/?api=1&query=${u},${h}`;window.open(w,"_blank")},o}});e.addControl(new m),s.bindPopup(`${t.title}`)}else s.bindPopup(`<a href="${t.url}">${t.title}</a>`)})});
